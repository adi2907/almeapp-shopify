<div id="recommended_for_you_alme" class="collection ">

</div>
<script xmlns="http://www.w3.org/1999/html">

    var user_data = "";
    // define a function to make ajax call to get the user data
    function get_user_rack_data1() {
        const base_url = 'https://almeapp.com';
        const max_items = 5;
        const alme_user_token = localStorage.getItem('alme_user_token');
        const most_visited_url = `${base_url}/api/most_visited/?max_items=${max_items}`;
        const visited_for_user = `${base_url}/api/test_visits/?token=${alme_user_token}&max_items=${max_items}`;
        const most_carted_url = `${base_url}/api/test_carts/?max_items=${max_items}`;
        const carted_for_user = `${base_url}/api/carts/?token=${alme_user_token}&max_items=${max_items}`;
        // try {
        //     const results = await Promise.all([
        //         fetch(most_visited_url),
        //         fetch(visited_for_user),
        //         fetch(most_carted_url),
        //         fetch(carted_for_user),
        //     ]);
        //     const api_response = await Promise.all(results.map(r => r.json()));
        //     const user_data = {
        //         most_viewed: api_response[0],
        //         viewed_for_user: api_response[1],
        //         most_carted: api_response[2],
        //         carted_for_user: api_response[3],
        //         user_token: alme_user_token,
       //     };
        //     return user_data;
        // } catch (error) {
        //     console.log(error);
        //     return null;
        // }
        if (!window.jQuery) {
            // jQuery is loaded

        }

        $.ajax({
            url: most_carted_url,
            cache: false,
            success: function(response){
                console.log(response);
                 user_data = {
                    most_carted: response,
                    user_token: alme_user_token,
                };
                return user_data;
            }
        });
    }
    window.onload = function(e) {
        user_data = get_user_rack_data1();
        var delayInMilliseconds = 1000; //1 second

        setTimeout(function() {

            console.log(user_data);
            //your code to be executed after 1 second
            var arrayLength = user_data.most_carted.length;
            var htmlData = '<div class="collection__title title-wrapper title-wrapper--no-top-margin page-width collection__title--desktop-slider"><h2 class="title inline-richtext h1"><strong>Recommended For You</strong></h2></div><slider-component class="slider-mobile-gutter page-width slider-component-desktop">    <ul id="recommended_for_you_alme_dipak" class="grid product-grid contains-card contains-card--product contains-card--standard grid--3-col-desktop grid--2-col-tablet-down slider slider--desktop" role="list" aria-label="Slider">'
            // $("#most_carted_alme").append('<slider-component class="slider-mobile-gutter page-width slider-component-desktop">    <ul id="Slider-template--19392271745334__featured_collection" class="grid product-grid contains-card contains-card--product contains-card--standard grid--3-col-desktop grid--2-col-tablet-down slider slider--desktop" role="list" aria-label="Slider">');
            for (var i = 0; i < arrayLength; i++) {
                var productInfo = "";
// WARNING: For GET requests, body is set to null by browsers.

                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                xhr.responseType = 'json';


                xhr.addEventListener("readystatechange", function() {

                    if(this.readyState === 4) {
                        var product = this.response.product;
                        console.log(product);
      /*                  htmlData = htmlData + '<li id="Slide-template--19392271745334__featured_collection-1" class="grid__item slider__slide">'+
                            '<div class="card-wrapper product-card-wrapper underline-links-hover">'+
                            '<div class=" card card--standard card--media   " style="--ratio-percent: 125.0%;">'+
                            '<div class="card__inner color-background-2 gradient ratio" style="--ratio-percent: 125.0%;"><div class="card__media">'+
                            '<div class="media media--transparent media--hover-effect">'+

                            '<img src="'+product.image.src+'" sizes="(min-width: 1600px) 367px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)" alt="product.title" class="motion-reduce" loading="lazy" width="1600" height="1600">  </div>'+
                            '</div><div class="card__content">       <div class="card__information">     <h3 class="card__heading">'+
                            '<a href="/products/'+product.handle+'" id="StandardCardNoMediaLink-template--19392271745334__featured_collection-8404321960246" class="full-unstyled-link" aria-labelledby="StandardCardNoMediaLink-template--19392271745334__featured_collection-8404321960246 NoMediaStandardBadge-template--19392271745334__featured_collection-8404321960246">'+
                            product.title+
                            '</a>   </h3>  </div>    <div class="card__badge bottom left"></div>     </div>                    </div>'+
                            '<div class="card__content">   <div class="card__information">'+
                            '<h3 class="card__heading h5" id="title-template--19392271745334__featured_collection-8404321960246">'+
                            '<a href="/products/'+product.handle+'" class="CardLink-template--19392271745334__featured_collection-8404321960246" class="full-unstyled-link" aria-labelledby="CardLink-template--19392271745334__featured_collection-8404321960246 Badge-template--19392271745334__featured_collection-8404321960246">'+
                            product.title +
                            ' </a>       </h3>                   <div class="card-information"><span class="caption-large light"></span>   <div class="  price ">       <div class="price__container"><div class="price__regular">     <span class="visually-hidden visually-hidden--inline">Regular price</span>      <span class="price-item price-item--regular">$'+
                            product.variants[0].price+
                            ' </span>  </div>  </div></div>    </div>    </div>   </div>  </div></div></li>                      ';*/
                        $("#recommended_for_you_alme_dipak").append('<li id="Slide-template--19392271745334__featured_collection-1" class="grid__item slider__slide">'+
                            '<div class="card-wrapper product-card-wrapper underline-links-hover">'+
                            '<div class=" card card--standard card--media   " style="--ratio-percent: 125.0%;">'+
                            '<div class="card__inner color-background-2 gradient ratio" style="--ratio-percent: 125.0%;"><div class="card__media">'+
                            '<div class="media media--transparent media--hover-effect">'+

                            '<img src="'+product.image.src+'" sizes="(min-width: 1600px) 367px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)" alt="product.title" class="motion-reduce" loading="lazy" width="1600" height="1600">  </div>'+
                            '</div><div class="card__content">       <div class="card__information">     <h3 class="card__heading">'+
                            '<a href="/products/'+product.handle+'" id="StandardCardNoMediaLink-template--19392271745334__featured_collection-8404321960246" class="full-unstyled-link" aria-labelledby="StandardCardNoMediaLink-template--19392271745334__featured_collection-8404321960246 NoMediaStandardBadge-template--19392271745334__featured_collection-8404321960246">'+
                            product.title+
                            '</a>   </h3>  </div>    <div class="card__badge bottom left"></div>     </div>                    </div>'+
                            '<div class="card__content">   <div class="card__information">'+
                            '<h3 class="card__heading h5" id="title-template--19392271745334__featured_collection-8404321960246">'+
                            '<a href="/products/'+product.handle+'" class="CardLink-template--19392271745334__featured_collection-8404321960246" class="full-unstyled-link" aria-labelledby="CardLink-template--19392271745334__featured_collection-8404321960246 Badge-template--19392271745334__featured_collection-8404321960246" style="color: black; text-decoration: none; ">'+
                            product.title +
                            ' </a>       </h3>                   <div class="card-information"><span class="caption-large light"></span>   <div class="  price ">       <div class="price__container"><div class="price__regular">     <span class="visually-hidden visually-hidden--inline">Regular price</span>      <span class="price-item price-item--regular">Rs. '+
                            product.variants[0].price+
                            ' </span>  </div>  </div></div>    </div>    </div>   </div>  </div></div></li>                      ');

                    }
                });

                xhr.open("GET", "/admin/api/2022-04/products/"+user_data.most_carted[i]+".json");
                xhr.setRequestHeader("X-Shopify-Access-Token", "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");

                xhr.send();
                    if((i+1) == arrayLength){
                        htmlData = htmlData + '   </ul>';
                        htmlData = htmlData + '   <div class="slider-buttons no-js-hidden">     <button type="button" class="slider-button slider-button--prev" name="previous" aria-label="Slide left" aria-controls="Slider-template--19392271745334__featured_collection">                <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">                <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">                </path></svg>           </button>            <div class="slider-counter caption">                <span class="slider-counter--current">4</span>                <span aria-hidden="true"> / </span>                <span class="visually-hidden">of</span>                <span class="slider-counter--total">4</span>            </div>            <button type="button" class="slider-button slider-button--next" name="next" aria-label="Slide right" aria-controls="Slider-template--19392271745334__featured_collection" disabled="disabled">                <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">                    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">                    </path></svg>            </button>        </div></slider-component>            ';

                        $("#recommended_for_you_alme").html(htmlData);
                        // $("#most_carted_alme").append('   <div class="slider-buttons no-js-hidden">     <button type="button" class="slider-button slider-button--prev" name="previous" aria-label="Slide left" aria-controls="Slider-template--19392271745334__featured_collection">                <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">                <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">                </path></svg>           </button>            <div class="slider-counter caption">                <span class="slider-counter--current">4</span>                <span aria-hidden="true"> / </span>                <span class="visually-hidden">of</span>                <span class="slider-counter--total">4</span>            </div>            <button type="button" class="slider-button slider-button--next" name="next" aria-label="Slide right" aria-controls="Slider-template--19392271745334__featured_collection" disabled="disabled">                <svg aria-hidden="true" focusable="false" class="icon icon-caret" viewBox="0 0 10 6">                    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor">                    </path></svg>            </button>        </div></slider-component>            ');

                    }

            }


        }, delayInMilliseconds);
    }


</script>


<style>
    @media screen and (min-width: 990px){
        .slider--desktop .slider__slide:first-child {
            margin-left: 0 !important;
            scroll-margin-left: 0 !important;
        }
    }
    .product-card {
        box-sizing: border-box;
        float: left;
        min-height: 1em;
        padding-left: 2em;
        vertical-align: top;
        width: 25%;
    }

    .visuallyhidden {
        border: 0;
        clip: rect(0 0 0 0);
        height: 1px;
        margin: -1px;
        overflow: hidden;
        padding: 0;
        position: absolute;
        width: 1px;
        white-space: nowrap;
    }
</style>





